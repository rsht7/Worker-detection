syntax = "proto3";

package surveillance;

// ----- Message Definitions -----

// Request from AI engine for a specific camera's zone data
message ZoneRequest {
  int32 camera_id = 1;
}

// Complete response containing multiple zones
message ZoneData {
  int32 camera_id = 1;
  repeated Zone zones = 2;
}

// Represents a single zone with polygon coordinates and rules
message Zone {
  int32 zone_id = 1; // Unique identifier for the zone
  bytes numpy_mask = 2; // Numpy array (serialized via np.save) for the zone mask
  repeated int32 rules = 3; // E.g., [0, 1]
}

// Alert sent from AI engine to backend
message AlertData {
  int32 camera_id = 1;
  int32 zone_id = 2; // Which zone triggered this alert
  int32 alert_type = 3; // e.g., 0 for "anomaly"
  int32 rule = 4; // e.g., 0 for "person_in_restricted"
  int32 confidence = 5; // Integer percentage, e.g., 85 = 85%
  string timestamp = 6; // ISO 8601 preferred
  bytes image = 7; // Annotated image (JPEG/PNG)
}

// Acknowledgement for alert receipt
message Ack {
  bool success = 1;
}

// ----- gRPC Service -----

service Surveillance {

  // AI polls this to get zones + rules for a camera
  rpc GetZoneData(ZoneRequest) returns (ZoneData);

  // AI pushes detected alerts to backend
  rpc SendAlert(AlertData) returns (Ack);
}
